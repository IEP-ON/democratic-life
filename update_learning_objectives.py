#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
학습목표 3영역(지식·이해, 과정·기능, 가치·태도) 보정 스크립트
"""

import re
from pathlib import Path

# 블록별 학습목표 정의 (교육과정 근거)
LEARNING_OBJECTIVES = {
    "블록01": {
        "지식·이해": "세계시민의 의미와 세계시민교육의 필요성을 설명할 수 있다.",
        "과정·기능": "글로벌 사례를 통해 세계화와 상호의존성을 탐구할 수 있다.",
        "가치·태도": "세계시민으로서의 정체성에 대한 관심과 기대감을 가질 수 있다."
    },
    "블록02": {
        "지식·이해": "세계시민이 갖춰야 할 가치(평화, 인권, 다양성 존중)를 이해할 수 있다.",
        "과정·기능": "다양한 사례를 통해 세계시민의 가치를 분석하고 분류할 수 있다.",
        "가치·태도": "세계시민의 가치를 존중하고 실천하려는 태도를 가질 수 있다."
    },
    "블록03": {
        "지식·이해": "세계시민의 역할과 책임을 이해할 수 있다.",
        "과정·기능": "SDGs와 연계하여 세계시민으로서 실천 가능한 행동을 탐색할 수 있다.",
        "가치·태도": "세계시민으로서의 책임감과 실천 의지를 가질 수 있다."
    },
    "블록04": {
        "지식·이해": "갈등의 의미와 유형(개인-개인, 개인-집단)을 이해할 수 있다.",
        "과정·기능": "갈등 사례를 분석하고 평화적 해결 방법을 탐구할 수 있다.",
        "가치·태도": "갈등을 평화적으로 해결하려는 태도를 가질 수 있다."
    },
    "블록05": {
        "지식·이해": "갈등의 원인과 바람직한 사회의 조건을 이해할 수 있다.",
        "과정·기능": "구체적 갈등 사례를 심층 분석하고 사회 구성 조건을 추론할 수 있다.",
        "가치·태도": "바람직한 사회를 만들기 위한 참여 의식을 가질 수 있다."
    },
    "블록06": {
        "지식·이해": "빈곤과 불평등의 개념, 민주주의와 공정사회의 의미를 이해할 수 있다.",
        "과정·기능": "빈곤과 불평등 사례를 조사하고 측정 방법을 탐구할 수 있다.",
        "가치·태도": "공정사회 실현을 위한 관심과 참여 의지를 가질 수 있다."
    },
    "블록07": {
        "지식·이해": "자유, 평등, 정의의 개념과 공정사회와의 관계를 이해할 수 있다.",
        "과정·기능": "자유·평등·정의를 실현하기 위한 국가·사회·개인 차원의 실천 방안을 탐구할 수 있다.",
        "가치·태도": "자유·평등·정의를 실천하려는 태도와 의지를 가질 수 있다."
    },
    "블록08": {
        "지식·이해": "영역1(사회정의와 평등) 학습 내용을 종합적으로 이해하고 있다.",
        "과정·기능": "포트폴리오를 정리하고 프로젝트를 발표할 수 있다.",
        "가치·태도": "자기평가와 동료평가를 통해 성찰하고 개선하려는 태도를 가질 수 있다."
    },
    "블록09": {
        "지식·이해": "글로벌 인권의 개념, 세계인권선언과 유엔아동권리협약의 내용을 이해할 수 있다.",
        "과정·기능": "글로벌 인권 이슈와 디지털·AI 인권 문제를 조사하고 분류할 수 있다.",
        "가치·태도": "글로벌 인권 보호에 대한 관심과 책임감을 가질 수 있다."
    },
    "블록10": {
        "지식·이해": "난민, 이주민, 인신매매, 아동노동 등 글로벌 인권 침해 사례를 이해할 수 있다.",
        "과정·기능": "글로벌 인권 침해 사례를 조사·분석하고 디지털 플랫폼 인권 문제를 탐구할 수 있다.",
        "가치·태도": "인권 침해에 대한 공감과 문제 해결 의지를 가질 수 있다."
    },
    "블록11": {
        "지식·이해": "인권 보호를 위한 국가·사회·개인의 역할을 이해할 수 있다.",
        "과정·기능": "인권 보호를 위한 구체적 행동 계획을 수립하고 디지털 시민성 실천 방안을 모색할 수 있다.",
        "가치·태도": "인권 보호를 위해 적극적으로 행동하려는 의지를 가질 수 있다."
    },
    "블록12": {
        "지식·이해": "문화다양성의 개념과 지구촌 발전과의 관계를 이해할 수 있다.",
        "과정·기능": "다양한 문화 사례를 통해 문화다양성의 가치를 탐구할 수 있다.",
        "가치·태도": "문화다양성을 존중하고 포용하려는 태도를 가질 수 있다."
    },
    "블록13": {
        "지식·이해": "문화 정체성(언어, 신념, 가치관)의 의미를 이해할 수 있다.",
        "과정·기능": "다양한 문화를 체험하고 비교·분석할 수 있다.",
        "가치·태도": "다양한 문화를 존중하고 이해하려는 태도를 가질 수 있다."
    },
    "블록14": {
        "지식·이해": "편견과 차별의 개념과 원인을 이해할 수 있다.",
        "과정·기능": "편견과 차별의 배경을 분석하고 지구촌 발전에 미치는 영향을 추론할 수 있다.",
        "가치·태도": "편견과 차별을 극복하려는 의지와 태도를 가질 수 있다."
    },
    "블록15": {
        "지식·이해": "문화다양성 존중의 의미와 실천 방법을 이해할 수 있다.",
        "과정·기능": "문화다양성 존중 캠페인을 기획하고 실천할 수 있다.",
        "가치·태도": "생활 속에서 문화다양성을 존중하고 실천하려는 태도를 가질 수 있다."
    },
    "블록16": {
        "지식·이해": "영역2(평화와 갈등, 인권) 학습 내용을 종합적으로 이해하고 있다.",
        "과정·기능": "포트폴리오를 정리하고 캠페인을 발표·실행할 수 있다.",
        "가치·태도": "자기평가와 동료평가를 통해 성찰하고 지속적으로 실천하려는 의지를 가질 수 있다."
    },
    "블록17": {
        "지식·이해": "32차시 전체 학습 내용과 세계시민의 역할을 종합적으로 이해할 수 있다.",
        "과정·기능": "전체 과정을 성찰하고 세계시민 실천 계획을 수립할 수 있다.",
        "가치·태도": "세계시민으로서의 정체성을 확립하고 지속적으로 실천하려는 다짐을 가질 수 있다."
    }
}

def format_objectives(objectives):
    """학습목표를 HTML 형식으로 포맷"""
    return f"""[지식·이해] {objectives['지식·이해']}
[과정·기능] {objectives['과정·기능']}
[가치·태도] {objectives['가치·태도']}"""

def update_html_file(file_path, block_num):
    """HTML 파일의 학습목표 업데이트"""
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    block_key = f"블록{block_num:02d}"
    if block_key not in LEARNING_OBJECTIVES:
        print(f"⚠️  {block_key} 학습목표 정의 없음")
        return False
    
    objectives = LEARNING_OBJECTIVES[block_key]
    new_objectives = format_objectives(objectives)
    
    # 학습목표 섹션 찾기 및 교체
    pattern = r'(<th>학습목표</th>\s*<td class="full-width" colspan="3">)(.*?)(</td>)'
    
    def replace_func(match):
        return f"{match.group(1)}{new_objectives}{match.group(3)}"
    
    new_content = re.sub(pattern, replace_func, content, flags=re.DOTALL)
    
    if new_content != content:
        with open(file_path, 'w', encoding='utf-8') as f:
            f.write(new_content)
        return True
    return False

def main():
    """메인 실행 함수"""
    base_dir = Path(__file__).parent
    
    # 지도안 디렉터리들
    plan_dirs = [
        base_dir / "지도안",
        base_dir / "docs" / "지도안",
        base_dir / "report" / "지도안",
        base_dir / "자료모음" / "지도안"
    ]
    
    updated_count = 0
    
    for plan_dir in plan_dirs:
        if not plan_dir.exists():
            continue
            
        print(f"\n📁 {plan_dir.relative_to(base_dir)}")
        
        for block_num in range(1, 18):
            # 파일 패턴 찾기
            pattern = f"블록{block_num:02d}_*.html"
            files = list(plan_dir.glob(pattern))
            
            for file_path in files:
                if update_html_file(file_path, block_num):
                    print(f"  ✅ {file_path.name}")
                    updated_count += 1
                else:
                    print(f"  ⏭️  {file_path.name} (변경 없음)")
    
    print(f"\n✨ 총 {updated_count}개 파일 업데이트 완료")

if __name__ == "__main__":
    main()
