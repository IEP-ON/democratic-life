// ë¸”ë¡ ìƒì„¸ ì •ë³´
const blockDetails = {
    1: {
        title: "ë¸”ë¡ 1: ì˜¤í”„ë‹ - ì„¸ê³„ì‹œë¯¼ê³¼ì˜ ë§Œë‚¨",
        session: "1ì°¨ì‹œ",
        standard: "- (ë‹¨ì› ë„ì…)",
        routine: "Connect-Extend-Challenge",
        objectives: [
            "ì„¸ê³„ì‹œë¯¼ì˜ ì˜ë¯¸ë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤",
            "ì„¸ê³„ì‹œë¯¼êµìœ¡ì˜ í•„ìš”ì„±ì„ ê¸€ë¡œë²Œ ì‚¬ë¡€ë¥¼ í†µí•´ ì´í•´í•  ìˆ˜ ìˆë‹¤",
            "ë¯¼ì£¼ì ì¸ ì‚¶ II êµìœ¡ê³¼ì •ì— ëŒ€í•œ ê¸°ëŒ€ê°ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤"
        ],
        activities: [
            "UNESCO ì„¸ê³„ì‹œë¯¼êµìœ¡ ì†Œê°œ ì˜ìƒ ì‹œì²­",
            "ì„¸ê³„ì‹œë¯¼ ê°œë… ì—°ê²°í•˜ê¸° (ë¸Œë ˆì¸ìŠ¤í† ë°)",
            "32ì°¨ì‹œ êµìœ¡ê³¼ì • ì†Œê°œ",
            "ë§ˆì¸ë“œë§µìœ¼ë¡œ ë„ì „ ê³¼ì œ ê·¸ë¦¬ê¸°"
        ],
        materials: "ì„¸ê³„ì‹œë¯¼-ë‚´ì§€-í•™ìƒìš©-0618.txt, 1-1_ì„¸ê³„ì‹œë¯¼ì€_ëˆ„êµ¬ì¼ê¹Œ.txt",
        differentiation: "ê¸€ë¡œë²Œ ë§¥ë½ ê°•ì¡°, ë„ë•ê³¼ ê°œì¸ ë„ë•ì„±ê³¼ êµ¬ë¶„",
        files: {
            plan: "ì§€ë„ì•ˆ/ë¸”ë¡01_ì˜¤í”„ë‹_ì„¸ê³„ì‹œë¯¼ê³¼ì˜ë§Œë‚¨.html",
            worksheet: "í•™ìŠµì§€/ë¸”ë¡01_í•™ìŠµì§€_ì„¸ê³„ì‹œë¯¼ê³¼ì˜ë§Œë‚¨.html"
        }
    },
    2: {
        title: "ë¸”ë¡ 2: ì„¸ê³„ì‹œë¯¼ì˜ ê°€ì¹˜ì™€ íƒœë„ I",
        session: "2-3ì°¨ì‹œ",
        standard: "[6ë¯¼ì£¼01-01]",
        routine: "See-Think-Wonder",
        objectives: [
            "ì„¸ê³„ì‹œë¯¼ìœ¼ë¡œì„œ ê°–ì¶°ì•¼ í•  ê°€ì¹˜ë¥¼ 3ê°€ì§€ ì´ìƒ ë§í•  ìˆ˜ ìˆë‹¤ (ê³µê°, ì±…ì„ê°, ì¡´ì¤‘, í˜‘ë ¥)",
            "ì„¸ê³„í™”ì™€ ìƒí˜¸ì˜ì¡´ì„±ì„ ê¸€ë¡œë²Œ ì‚¬ë¡€ë¡œ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤",
            "êµ­ì œì‚¬íšŒì—ì„œ ì„¸ê³„ì‹œë¯¼ìœ¼ë¡œì„œì˜ ì‚¶ì„ ì‹¤ì²œí•˜ê¸° ìœ„í•œ íƒœë„ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤"
        ],
        activities: [
            "[See] ê¸€ë¡œë²Œ ì´ìŠˆ ì‚¬ì§„ 10ì¥ ê´€ì°° (ë‚œë¯¼, êµ­ì œì›ì¡°, ê¸°í›„ë³€í™”, ë¬´ì—­)",
            "[Think] ì„¸ê³„ì‹œë¯¼ 4ê°€ì§€ ê°€ì¹˜ ìƒê°í•˜ê¸°",
            "[Wonder] UNESCO/NGO ì˜ìƒ ë³´ê³  ê¶ê¸ˆí•œ ì  íƒêµ¬",
            "ì„¸ê³„ì‹œë¯¼ ì‹¤ì²œ ì•½ì† ì¹´ë“œ ì‘ì„±"
        ],
        materials: "1-1_ì„¸ê³„ì‹œë¯¼ì€_ëˆ„êµ¬ì¼ê¹Œ.txt, ì„¸ê³„ì‹œë¯¼-ë‚´ì§€-í•™ìƒìš©-0618.txt, UNESCO ì˜ìƒ",
        differentiation: "êµ­ì œì‚¬íšŒ ë§¥ë½ ê°•ì¡°, ë„ë•ê³¼ ë•ëª©(ì„±ì‹¤Â·íš¨Â·ìš°ì• )ê³¼ êµ¬ë¶„, ê¸€ë¡œë²Œ ì´ìŠˆ ì¤‘ì‹¬",
        files: {
            plan: "ì§€ë„ì•ˆ/ë¸”ë¡02_ì„¸ê³„ì‹œë¯¼ì˜_ê°€ì¹˜ì™€_íƒœë„I.html",
            worksheet: "í•™ìŠµì§€/ë¸”ë¡02_í•™ìŠµì§€_ì„¸ê³„ì‹œë¯¼ì˜_ê°€ì¹˜ì™€_íƒœë„I.html"
        }
    },
    3: {
        title: "ë¸”ë¡ 3: ì„¸ê³„ì‹œë¯¼ì˜ ê°€ì¹˜ì™€ íƒœë„ II",
        session: "4-5ì°¨ì‹œ",
        standard: "[6ë¯¼ì£¼01-01]",
        routine: "Think-Pair-Share, Connect-Extend-Challenge",
        objectives: [
            "ë¬¸í™” ì •ì²´ì„±ì—ì„œ ì–¸ì–´Â·ì‹ ë…Â·ê°€ì¹˜ê´€ì˜ ì¤‘ìš”ì„±ì„ ê¸€ë¡œë²Œ ë§¥ë½ì—ì„œ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤",
            "ë‹¤ì–‘ì„± ì¡´ì¤‘ì˜ í•„ìš”ì„±ì„ ì§€êµ¬ì´Œ ë°œì „ê³¼ ì—°ê²°í•˜ì—¬ ì´í•´í•  ìˆ˜ ìˆë‹¤",
            "SDGs 17ê°œ ëª©í‘œì™€ ì„¸ê³„ì‹œë¯¼ì˜ ì—­í• ì„ ì—°ê²°í•˜ì—¬ í–‰ë™ ê³„íšì„ ìˆ˜ë¦½í•  ìˆ˜ ìˆë‹¤"
        ],
        activities: [
            "[Think-Pair-Share] ë¬¸í™” ì •ì²´ì„± íƒêµ¬ (ì–¸ì–´Â·ì‹ ë…Â·ê°€ì¹˜ê´€)",
            "UNESCO ë¬¸í™”ë‹¤ì–‘ì„± ì˜ìƒ ì‹œì²­",
            "[Connect-Extend-Challenge] SDGs 17ê°œ ëª©í‘œ íƒêµ¬",
            "ì‹¤ì²œ ê°€ëŠ¥í•œ SDGs í–‰ë™ ê³„íš ìˆ˜ë¦½"
        ],
        materials: "1-1_ì„¸ê³„ì‹œë¯¼ì€_ëˆ„êµ¬ì¼ê¹Œ.txt (SDGs ë¶€ë¶„), SDGs í¬ìŠ¤í„°, UNESCO ì˜ìƒ",
        differentiation: "ê¸€ë¡œë²Œ ë¬¸í™”ë‹¤ì–‘ì„±, SDGs(êµ­ì œ ëª©í‘œ), ìœ ì—”Â·êµ­ì œ í˜‘ë ¥ ê°•ì¡°",
        files: {
            plan: "ì§€ë„ì•ˆ/ë¸”ë¡03_ì„¸ê³„ì‹œë¯¼ì˜_ê°€ì¹˜ì™€_íƒœë„II.html",
            worksheet: "ì˜ˆì •"
        }
    }
};

// ëª¨ë‹¬ ì œì–´
function showBlockDetail(blockNum) {
    const block = blockDetails[blockNum];
    if (!block) {
        alert('ë¸”ë¡ ' + blockNum + ' ì •ë³´ëŠ” ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        return;
    }
    
    const modal = document.getElementById('blockModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    
    let filesHtml = '';
    if (block.files.plan) {
        filesHtml += `<a href="#" onclick="openHtmlPreview('${block.files.plan}', 'ì§€ë„ì•ˆ'); return false;" class="file-link">ğŸ“„ ì§€ë„ì•ˆ ë³´ê¸°</a> `;
    }
    if (block.files.worksheet && block.files.worksheet !== 'ì˜ˆì •') {
        filesHtml += `<a href="#" onclick="openHtmlPreview('${block.files.worksheet}', 'í•™ìŠµì§€'); return false;" class="file-link">ğŸ“ í•™ìŠµì§€ ë³´ê¸°</a>`;
    }
    
    modalTitle.innerHTML = block.title;
    modalBody.innerHTML = `
        <div style="margin-bottom: 20px;">
            <h3 style="color: #1e3c72; margin-bottom: 10px;">ê¸°ë³¸ ì •ë³´</h3>
            <p><strong>ì°¨ì‹œ:</strong> ${block.session}</p>
            <p><strong>ì„±ì·¨ê¸°ì¤€:</strong> ${block.standard}</p>
            <p><strong>ì‚¬ê³ ë£¨í‹´:</strong> ${block.routine}</p>
        </div>
        
        <div style="margin-bottom: 20px;">
            <h3 style="color: #1e3c72; margin-bottom: 10px;">í•™ìŠµëª©í‘œ</h3>
            <ul style="line-height: 2;">
                ${block.objectives.map(obj => `<li>${obj}</li>`).join('')}
            </ul>
        </div>
        
        <div style="margin-bottom: 20px;">
            <h3 style="color: #1e3c72; margin-bottom: 10px;">ì£¼ìš” í™œë™</h3>
            <ul style="line-height: 2;">
                ${block.activities.map(act => `<li>${act}</li>`).join('')}
            </ul>
        </div>
        
        <div style="margin-bottom: 20px;">
            <h3 style="color: #1e3c72; margin-bottom: 10px;">í™œìš© ìë£Œ</h3>
            <p style="background: #f8f9fa; padding: 10px; border-radius: 5px;">${block.materials}</p>
        </div>
        
        <div style="margin-bottom: 20px;">
            <h3 style="color: #1e3c72; margin-bottom: 10px;">ì°¨ë³„í™” í¬ì¸íŠ¸</h3>
            <p style="background: #fff3e0; padding: 10px; border-radius: 5px; border-left: 4px solid #FF9800;">
                ${block.differentiation}
            </p>
        </div>
        
        <div style="margin-top: 25px; padding-top: 20px; border-top: 2px solid #e0e0e0; text-align: center;">
            <h3 style="color: #1e3c72; margin-bottom: 15px;">ğŸ“¥ ì‚°ì¶œë¬¼ ë‹¤ìš´ë¡œë“œ</h3>
            ${filesHtml || '<p style="color: #999;">ì‚°ì¶œë¬¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤</p>'}
        </div>
    `;
    
    modal.style.display = 'block';
}

function closeModal() {
    document.getElementById('blockModal').style.display = 'none';
}

// ìŠ¤í¬ë¡¤ í•¨ìˆ˜
function scrollToSection(id) {
    document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
}

// ì•„ì½”ë””ì–¸
function toggleAccordion(element) {
    const header = element;
    const content = header.nextElementSibling;
    const isActive = header.classList.contains('active');
    
    // ëª¨ë“  ì•„ì½”ë””ì–¸ ë‹«ê¸°
    document.querySelectorAll('.accordion-header').forEach(h => {
        h.classList.remove('active');
        h.nextElementSibling.classList.remove('active');
    });
    
    // í´ë¦­í•œ ì•„ì½”ë””ì–¸ í† ê¸€
    if (!isActive) {
        header.classList.add('active');
        content.classList.add('active');
    }
}

// íƒ­
function showTab(tabName) {
    // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // ì„ íƒí•œ íƒ­ í‘œì‹œ
    document.getElementById(tabName).classList.add('active');
    event.target.classList.add('active');
}

// íŒŒì¼ ì—´ê¸° (ë§ˆí¬ë‹¤ìš´/HTML ëª¨ë‘ ì›¹ì—ì„œ ë Œë”ë§)
function openFile(filePath) {
    if (filePath.endsWith('.md')) {
        openMarkdownFile(filePath);
    } else if (filePath.endsWith('.html')) {
        openHtmlPreview(filePath, 'ë¬¸ì„œ');
    } else {
        window.open(filePath, '_blank');
    }
}

// ë§ˆí¬ë‹¤ìš´ íŒŒì¼ ì›¹ì—ì„œ ë Œë”ë§
async function openMarkdownFile(filePath) {
    const modal = document.getElementById('mdModal');
    const title = document.getElementById('mdModalTitle');
    const content = document.getElementById('mdContent');
    
    // íŒŒì¼ëª…ì—ì„œ ì œëª© ì¶”ì¶œ
    const fileName = filePath.split('/').pop().replace('.md', '');
    title.textContent = fileName;
    
    // ë¡œë”© í‘œì‹œ
    content.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">ğŸ“„ ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
    modal.style.display = 'block';
    
    try {
        const response = await fetch(filePath);
        if (!response.ok) {
            throw new Error('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
        
        const markdown = await response.text();
        
        // marked.jsë¡œ ë§ˆí¬ë‹¤ìš´ì„ HTMLë¡œ ë³€í™˜
        const html = marked.parse(markdown);
        
        // ìŠ¤íƒ€ì¼ ì ìš©ëœ HTMLë¡œ í‘œì‹œ
        content.innerHTML = `
            <style>
                #mdContent { 
                    font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
                    color: #333;
                }
                #mdContent h1 { 
                    font-size: 24pt; 
                    color: #1e3c72; 
                    border-bottom: 3px solid #1e3c72; 
                    padding-bottom: 10px; 
                    margin: 20px 0 15px 0;
                }
                #mdContent h2 { 
                    font-size: 20pt; 
                    color: #2a5298; 
                    border-bottom: 2px solid #ddd;
                    padding-bottom: 8px;
                    margin: 25px 0 12px 0;
                }
                #mdContent h3 { 
                    font-size: 16pt; 
                    color: #1e3c72; 
                    margin: 20px 0 10px 0;
                }
                #mdContent p { 
                    margin: 10px 0; 
                    line-height: 1.8;
                }
                #mdContent ul, #mdContent ol { 
                    margin: 10px 0; 
                    padding-left: 30px;
                    line-height: 1.8;
                }
                #mdContent li { 
                    margin: 6px 0;
                }
                #mdContent table { 
                    width: 100%; 
                    border-collapse: collapse; 
                    margin: 15px 0;
                    font-size: 10pt;
                }
                #mdContent th, #mdContent td { 
                    border: 1px solid #ddd; 
                    padding: 10px; 
                    text-align: left;
                }
                #mdContent th { 
                    background: #1e3c72; 
                    color: white; 
                    font-weight: 600;
                }
                #mdContent tr:nth-child(even) { 
                    background: #f8f9fa;
                }
                #mdContent code {
                    background: #f4f4f4;
                    padding: 2px 6px;
                    border-radius: 3px;
                    font-family: 'Courier New', monospace;
                    font-size: 10pt;
                }
                #mdContent pre {
                    background: #f4f4f4;
                    padding: 15px;
                    border-radius: 5px;
                    overflow-x: auto;
                    border-left: 4px solid #2196F3;
                }
                #mdContent pre code {
                    background: none;
                    padding: 0;
                }
                #mdContent blockquote {
                    border-left: 4px solid #2196F3;
                    padding-left: 15px;
                    margin: 15px 0;
                    color: #666;
                    font-style: italic;
                }
                #mdContent strong {
                    color: #1e3c72;
                    font-weight: 700;
                }
                #mdContent hr {
                    border: none;
                    border-top: 2px solid #ddd;
                    margin: 25px 0;
                }
            </style>
            ${html}
        `;
        
    } catch (error) {
        content.innerHTML = `
            <div style="text-align: center; padding: 40px;">
                <p style="font-size: 16pt; color: #f44336;">âŒ ì˜¤ë¥˜</p>
                <p style="color: #666; margin-top: 10px;">${error.message}</p>
                <p style="color: #999; font-size: 10pt; margin-top: 15px;">íŒŒì¼ ê²½ë¡œ: ${filePath}</p>
            </div>
        `;
    }
}

// ë§ˆí¬ë‹¤ìš´ ëª¨ë‹¬ ë‹«ê¸°
function closeMdModal() {
    document.getElementById('mdModal').style.display = 'none';
}

// HTML ë¯¸ë¦¬ë³´ê¸° (ì§€ë„ì•ˆ/í•™ìŠµì§€)
function openHtmlPreview(filePath, fileType) {
    const modal = document.getElementById('mdModal');
    const title = document.getElementById('mdModalTitle');
    const modalBody = document.getElementById('mdModalBody');
    
    title.textContent = fileType + ' ë¯¸ë¦¬ë³´ê¸°';
    
    modalBody.innerHTML = `
        <div style="margin-bottom: 15px; text-align: right;">
            <button onclick="window.open('${filePath}', '_blank')" 
                    style="background: #2196F3; color: white; border: none; padding: 10px 20px; 
                           border-radius: 5px; cursor: pointer; font-weight: 600;">
                ğŸ”— ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
            </button>
        </div>
        <iframe src="${filePath}" 
                style="width: 100%; height: 60vh; border: 1px solid #ddd; border-radius: 5px;"
                frameborder="0">
        </iframe>
    `;
    
    modal.style.display = 'block';
}

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
window.onclick = function(event) {
    const blockModal = document.getElementById('blockModal');
    const mdModal = document.getElementById('mdModal');
    
    if (event.target == blockModal) {
        blockModal.style.display = 'none';
    }
    if (event.target == mdModal) {
        mdModal.style.display = 'none';
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    console.log('í”„ë¡œì íŠ¸ ë³´ê³ ì„œ ë¡œë“œ ì™„ë£Œ');
});
